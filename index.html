<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Japan Healthcare Market Research — FAQ | Seed Planning</title>
<meta name="description" content="Comprehensive FAQ for conducting healthcare market research in Japan. Patients, HCP, System, Compliance, Fieldwork, Operations, Timeline." />
<style>
  :root{
    --bg:#ffffff; --ink:#20323a; --muted:#5f7a84; --line:#e6eff1;
    --accent:#2f6f7e; --accent-2:#5baaae; --chip:#edf7f7; --mark:#fff3b0;
    --radius:14px; --radius-sm:10px; --shadow:0 4px 18px rgba(20,50,60,.08);
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font-family:"Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"; line-height:1.65;}
  a{color:var(--accent); text-decoration:none;} a:hover{text-decoration:underline;}
  header{position:sticky; top:0; z-index:40; background:rgba(255,255,255,.9); backdrop-filter:saturate(180%) blur(8px); border-bottom:1px solid var(--line);}
  .wrap{max-width:1100px; margin:0 auto; padding:22px 20px;}
  .brand{display:flex; align-items:center; gap:14px;}
  .brand img{height:34px; width:auto; display:block;}
  .brand .title{font-weight:700; font-size:18px; letter-spacing:.2px;}
  .brand .tag{color:var(--muted); font-size:13px}
  .topbar{display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap}
  .search{position:relative; flex:1 1 520px; max-width:680px; display:flex; align-items:center; gap:10px; background:#fff; border:1px solid var(--line); border-radius:999px; padding:8px 14px; box-shadow:var(--shadow);}
  .search input{flex:1; border:0; outline:0; font-size:16px; min-width:120px; background:transparent; padding:6px 2px;}
  .search .kbd{font-size:12px; color:var(--muted); border:1px solid var(--line); padding:2px 6px; border-radius:6px;}
  .suggest{position:absolute; top:48px; left:0; right:0; background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:var(--shadow); overflow:hidden; display:none; max-height:360px; overflow-y:auto;}
  .suggest.visible{display:block;}
  .s-item{padding:12px 14px; border-bottom:1px solid var(--line); cursor:pointer;}
  .s-item:last-child{border-bottom:0;}
  .s-item .s-title{font-weight:600;}
  .s-item .s-snippet{font-size:13px; color:var(--muted);}
  .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .chip{background:var(--chip); color:var(--accent); border:1px solid #d9ecec; padding:6px 10px; border-radius:999px; font-size:12px;}
  main .intro{margin:26px 0 8px; padding:18px; border:1px solid var(--line); border-radius:var(--radius); background:#fbfeff;}
  h2.section-title{margin:34px 0 14px; padding-bottom:8px; border-bottom:2px solid var(--accent-2); display:flex; align-items:center; gap:10px;}
  .badge{font-size:12px; background:var(--chip); color:var(--accent); border:1px solid #d9ecec; padding:2px 8px; border-radius:999px}
  .faq-grid{display:grid; grid-template-columns:1fr; gap:14px;}
  @media (min-width: 860px){ .faq-grid{grid-template-columns:1fr 1fr;} }
  article.faq{background:#fff; border:1px solid var(--line); border-radius:var(--radius-sm); padding:16px 16px 12px; box-shadow:var(--shadow); scroll-margin-top:110px;}
  .q{font-weight:700; margin:0 0 8px; font-size:18px;}
  .a{margin:0 0 8px;}
  .meta{display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-top:8px}
  .tag{font-size:12px; color:var(--muted);}
  .back{margin-left:auto; font-size:13px;}
  mark{background:var(--mark); padding:0 .2em;}
  footer.site{margin:36px 0 80px; color:var(--muted); font-size:13px; text-align:center;}
  .index-link{font-size:13px;}
  :focus-visible{outline:3px solid #bfe3e6; outline-offset:2px}
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <img src="seed-planning-logo.png" alt="Seed Planning" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block'">
      <div class="title" style="display:none">Seed Planning</div>
      <div class="tag">Japan Healthcare Market Research — FAQ</div>
    </div>
    <div class="search" role="search" aria-label="Search FAQ">
      <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M10 2a8 8 0 0 1 6.32 12.906l4.387 4.387l-1.414 1.414l-4.387-4.387A8 8 0 1 1 10 2m0 2a6 6 0 1 0 0 12a6 6 0 0 0 0-12"/></svg>
      <input id="search" type="search" placeholder="Search keywords (title & content)..." autocomplete="off" aria-controls="suggest-list" />
      <div class="kbd">/</div>
      <div id="suggest" class="suggest" role="listbox" aria-label="Search suggestions"></div>
      <!-- Import controls (manual fallback) -->
      <button id="importBtn" class="chip" style="border:none;cursor:pointer" aria-label="Import FAQ">Import</button>
      <input id="fileInput" type="file" accept=".csv,.json" style="display:none" />
    </div>
  </div>
</header>

<div class="wrap">
  <div id="index" class="intro">
    <p><strong>Purpose.</strong> This FAQ collects essential guidance for running healthcare market research in Japan—patients, HCPs, system context, compliance, fieldwork, operations, and timeline. Use the search box above for instant suggestions and highlighted matches. Each answer includes a <em>Back to Index</em> link.</p>
    <div class="chips" aria-label="Quick filters">
      <a class="chip" href="#Patients">Patients</a>
      <a class="chip" href="#HCP">HCP</a>
      <a class="chip" href="#System">System</a>
      <a class="chip" href="#Compliance">Compliance</a>
      <a class="chip" href="#Fieldwork">Fieldwork</a>
      <a class="chip" href="#Operations">Operations</a>
      <a class="chip" href="#Timeline">Timeline</a>
    </div>
  </div>

  <!-- Sections (items can appear in multiple sections) -->
  <section id="Patients">
    <h2 class="section-title">Patients <span class="badge" id="count-Patients"></span> <span class="index-link"><a href="#index">Back to Index</a></span></h2>
    <div class="faq-grid" data-section="Patients"></div>
  </section>

  <section id="HCP">
    <h2 class="section-title">HCP <span class="badge" id="count-HCP"></span> <span class="index-link"><a href="#index">Back to Index</a></span></h2>
    <div class="faq-grid" data-section="HCP"></div>
  </section>

  <section id="System">
    <h2 class="section-title">System <span class="badge" id="count-System"></span> <span class="index-link"><a href="#index">Back to Index</a></span></h2>
    <div class="faq-grid" data-section="System"></div>
  </section>

  <section id="Compliance">
    <h2 class="section-title">Compliance <span class="badge" id="count-Compliance"></span> <span class="index-link"><a href="#index">Back to Index</a></span></h2>
    <div class="faq-grid" data-section="Compliance"></div>
  </section>

  <section id="Fieldwork">
    <h2 class="section-title">Fieldwork <span class="badge" id="count-Fieldwork"></span> <span class="index-link"><a href="#index">Back to Index</a></span></h2>
    <div class="faq-grid" data-section="Fieldwork"></div>
  </section>

  <section id="Operations">
    <h2 class="section-title">Operations <span class="badge" id="count-Operations"></span> <span class="index-link"><a href="#index">Back to Index</a></span></h2>
    <div class="faq-grid" data-section="Operations"></div>
  </section>

  <section id="Timeline">
    <h2 class="section-title">Timeline <span class="badge" id="count-Timeline"></span> <span class="index-link"><a href="#index">Back to Index</a></span></h2>
    <div class="faq-grid" data-section="Timeline"></div>
  </section>

  <footer class="site">
    <p>© <span id="year"></span> Seed Planning. All rights reserved. | <a href="#index">Back to Index</a></p>
  </footer>
</div>

<script>
/* =======================
   Base data (kept dummy)
=======================*/
const FAQS = [
  /* 既存のダミーを残しておく。CSV読み込み後に本番Q1–Q68で上書き/追加されます。*/
  { id:"p1", question:"How are patient panels typically recruited in Japan?",
    answer:"Recruitment often combines clinic partners, patient advocacy groups, and carefully screened online panels. Direct-to-patient outreach needs culturally sensitive language and explicit clarity on consent and incentives.",
    categories:["Patients","Fieldwork","Compliance"], primary:"Patients" },
  { id:"p2", question:"Are rare disease patients feasible to recruit without hospitals?",
    answer:"Feasible but slower. Social media and advocacy communities help, yet IRB-like review from partners and careful privacy handling are essential. Expect extended screening and staggered quotas.",
    categories:["Patients","Compliance","Timeline"], primary:"Patients" },
  { id:"hcp1", question:"What incentives are appropriate for physicians in Japan?",
    answer:"Honoraria should reflect specialty and time. Many physicians prefer bank transfer and clear tax documentation. Consider after-hours scheduling and concise stimuli to respect clinic workload.",
    categories:["HCP","Operations","Compliance"], primary:"HCP" },
  { id:"hcp2", question:"Can we conduct detailing-like concept tests with HCPs?",
    answer:"Yes, with guardrails. Avoid promotional framing; keep it research-only, anonymized, and compliant with industry codes. Secure NDAs when showing proprietary content.",
    categories:["HCP","Compliance","Fieldwork"], primary:"HCP" },
  { id:"sys1", question:"What should we know about Japan’s reimbursement landscape?",
    answer:"Japan has a universal coverage system with national fee schedules. Reimbursement updates are periodic and can affect prescribing behavior; context questions should probe facility type and payer interactions.",
    categories:["System","HCP","Operations"], primary:"System" },
  { id:"cmp1", question:"Is written consent mandatory for all interviews?",
    answer:"Written or verifiable digital consent is strongly recommended. For patients, provide easy-to-understand sheets; for HCPs, include data usage, recording policy, and incentive details.",
    categories:["Compliance","Fieldwork","Patients","HCP"], primary:"Compliance" },
  { id:"fw1", question:"Any etiquette tips when moderating Japanese interviews?",
    answer:"Begin with appreciative tone, use honorifics, and avoid rapid-fire probing early. Silence can be reflective—give space. Clarify recording and anonymization upfront.",
    categories:["Fieldwork","HCP","Patients","Cultural"], primary:"Fieldwork" },
  { id:"op1", question:"What platform is preferred for online interviews?",
    answer:"Zoom is common; Teams also accepted for enterprise clients. Always run pre-checks for audio, recording permission, and stimulus compatibility (fonts, Japanese input).",
    categories:["Operations","Fieldwork","Compliance"], primary:"Operations" },
  { id:"time1", question:"Typical timeline for 20 HCP IDIs in a specialized area?",
    answer:"Screening 3–4 weeks, fieldwork 2 weeks, and 1 week for synthesis—~5–6 weeks total. Add buffer for approvals and materials translation.",
    categories:["Timeline","HCP","Operations"], primary:"Timeline" },
  { id:"sys2", question:"Can we mix facility types in one quota?",
    answer:"Yes, but analyze separately. University hospitals, clinics, and cancer centers have distinct roles. Quotas should reflect real-world patient flow.",
    categories:["System","HCP","Operations"], primary:"System" },
  { id:"cmp2", question:"How do we handle PII under Japanese regulations?",
    answer:"Minimize collection, store securely, and use anonymized IDs. Share only aggregated insights. When in doubt, treat as sensitive and restrict access.",
    categories:["Compliance","Operations"], primary:"Compliance" },
];

/* ============= Helpers =============*/
function escapeHTML(str){ return String(str||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function renderSections(){
  const counts = Object.fromEntries(SECTIONS.map(s=>[s,0]));
  SECTIONS.forEach(section=>{
    const grid = document.querySelector(`.faq-grid[data-section="${section}"]`);
    grid.innerHTML = '';
    FAQS.filter(f=>f.categories.includes(section)).forEach(f=>{
      counts[section]++;
      const anchorId = `${f.id}-${(f.primary || f.categories[0])}`;
      const tags = f.categories.map(c=>`<span class="tag">#${c}</span>`).join(' ');
      grid.insertAdjacentHTML('beforeend', `
        <article class="faq" id="${anchorId}" data-faq-id="${f.id}">
          <h3 class="q">${escapeHTML(f.question)}</h3>
          <p class="a">${escapeHTML(f.answer)}</p>
          <div class="meta">
            ${tags}
            <a class="back" href="#index" aria-label="Back to Index">Back to Index</a>
          </div>
        </article>
      `);
    });
    const badge = document.getElementById(`count-${section}`);
    if(badge) badge.textContent = counts[section];
  });
}

/* ============= Search/Suggest =============*/
const searchInput = document.getElementById('search');
const suggestBox = document.getElementById('suggest');

function normalize(s){ return String(s||"").toLowerCase(); }

const INDEX = () => FAQS.map(f=>({
  id:f.id, primary:f.primary || f.categories[0],
  text:(f.question+" "+f.answer).toLowerCase(),
  question:f.question, answer:f.answer
}));

function scoreMatch(q, item){
  const qi = normalize(q).split(/\s+/).filter(Boolean);
  if(!qi.length) return 0;
  let score = 0;
  qi.forEach(term=>{
    if(item.text.includes(term)) score += 2;
    if(item.question.toLowerCase().includes(term)) score += 2;
  });
  return score;
}

function snippet(text, q){
  const t = String(text||"");
  const idx = t.toLowerCase().indexOf(q.toLowerCase());
  if(idx < 0) return escapeHTML(t.slice(0, 140)) + (t.length>140?'…':'');
  const start = Math.max(0, idx - 60);
  const end = Math.min(t.length, idx + q.length + 60);
  const pre = escapeHTML(t.slice(start, idx));
  const hit = `<mark>${escapeHTML(t.slice(idx, idx+q.length))}</mark>`;
  const post = escapeHTML(t.slice(idx+q.length, end));
  return (start>0?'…':'') + pre + hit + post + (end<t.length?'…':'');
}

function clearHighlights(){
  document.querySelectorAll('mark[data-auto="1"]').forEach(m=>{
    const parent = m.parentNode; m.outerHTML = m.textContent; parent.normalize();
  });
}

function highlightElement(el, q){
  if(!q) return;
  const selector = ['.q','.a'];
  selector.forEach(sel=>{
    const node = el.querySelector(sel); if(!node) return;
    node.querySelectorAll('mark[data-auto="1"]').forEach(m=>{ m.outerHTML = m.textContent; });
    const walk = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null);
    const terms = q.trim().split(/\s+/).filter(Boolean);
    let n, textNodes=[]; while(n = walk.nextNode()) textNodes.push(n);
    textNodes.forEach(tn=>{
      let data = tn.nodeValue;
      terms.forEach(term=>{
        if(!term) return;
        const re = new RegExp(term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
        data = data.replace(re, m=>`<<MARK>>${m}<<END>>`);
      });
      if(data !== tn.nodeValue){
        const frag = document.createDocumentFragment();
        data.split('<<END>>').forEach(chunk=>{
          const parts = chunk.split('<<MARK>>');
          if(parts[0]) frag.appendChild(document.createTextNode(parts[0]));
          if(parts[1]){
            const mk = document.createElement('mark');
            mk.dataset.auto="1";
            mk.textContent = parts[1];
            frag.appendChild(mk);
          }
        });
        tn.parentNode.replaceChild(frag, tn);
      }
    });
  });
}

function highlightAll(q){
  clearHighlights();
  if(!q) return;
  document.querySelectorAll('article.faq').forEach(el=> highlightElement(el, q));
}

function updateSuggest(value){
  const q = value.trim();
  const index = INDEX();
  if(!q){ suggestBox.classList.remove('visible'); suggestBox.innerHTML = ''; clearHighlights(); return; }
  const ranked = index.map(it=>({it, score:scoreMatch(q, it)}))
                      .filter(x=>x.score>0)
                      .sort((a,b)=>b.score-a.score)
                      .slice(0, 12);
  if(!ranked.length){ suggestBox.classList.remove('visible'); suggestBox.innerHTML = ''; clearHighlights(); return; }
  suggestBox.innerHTML = ranked.map(({it})=>{
    const snip = snippet(it.answer, q);
    return `<div class="s-item" role="option" data-id="${it.id}" tabindex="0">
      <div class="s-title">${escapeHTML(it.question)}</div>
      <div class="s-snippet">${snip}</div>
    </div>`;
  }).join('');
  suggestBox.classList.add('visible');
  highlightAll(q);
}

searchInput.addEventListener('input', e=> updateSuggest(e.target.value));
searchInput.addEventListener('focus', e=> updateSuggest(e.target.value));
document.addEventListener('keydown', e=>{
  if(e.key === '/' && !/input|textarea/i.test(document.activeElement.tagName)){
    e.preventDefault(); searchInput.focus();
  }
  if(e.key === 'Escape'){ suggestBox.classList.remove('visible'); suggestBox.innerHTML = ''; clearHighlights(); }
});
suggestBox.addEventListener('click', e=>{
  const item = e.target.closest('.s-item');
  if(item){ goToItem(item.dataset.id); suggestBox.classList.remove('visible'); }
});
suggestBox.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    const item = e.target.closest('.s-item');
    if(item){ goToItem(item.dataset.id); suggestBox.classList.remove('visible'); }
  }
});
document.addEventListener('click', e=>{
  if(!e.target.closest('.search')){ suggestBox.classList.remove('visible'); }
});

function goToItem(id){
  const item = FAQS.find(x=>x.id===id);
  const targetId = item ? `${id}-${(item.primary || item.categories[0])}` : null;
  const el = targetId ? document.getElementById(targetId) : null;
  if(el){
    el.scrollIntoView({behavior:'smooth', block:'start'});
    el.setAttribute('tabindex','-1');
    el.focus({preventScroll:true});
  }
}

/* ============= CSV Import (manual) =============*/
const fileInput = document.getElementById('fileInput');
const importBtn = document.getElementById('importBtn');

function parseCSV(text){
  const rows = [];
  let i=0, cur='', inQuotes=false, row=[];
  while(i<text.length){
    const c=text[i], n=text[i+1];
    if(inQuotes){
      if(c==='"' && n==='"'){ cur+='"'; i+=2; continue; }
      if(c==='"'){ inQuotes=false; i++; continue; }
      cur+=c; i++; continue;
    }else{
      if(c==='"'){ inQuotes=true; i++; continue; }
      if(c===','){ row.push(cur); cur=''; i++; continue; }
      if(c==='\n'){ row.push(cur); rows.push(row); row=[]; cur=''; i++; continue; }
      if(c==='\r'){ i++; continue; }
      cur+=c; i++; continue;
    }
  }
  row.push(cur); rows.push(row);
  const header = rows.shift().map(h=>h.trim());
  return rows.filter(r=>r.some(x=>x && x.trim()!=='')).map(r=>{
    const obj={};
    header.forEach((h,idx)=> obj[h]= (r[idx]??'').trim());
    return obj;
  });
}

function mergeItems(items){
  const byId = Object.fromEntries(FAQS.map(x=>[x.id,x]));
  items.forEach(raw=>{
    const id = (raw.id||'').trim();
    if(!id) return;
    const cats = (raw.categories||'').split(';').map(s=>s.trim()).filter(Boolean);
    const merged = {
      id,
      question: raw.question||byId[id]?.question||'',
      answer: raw.answer||byId[id]?.answer||'',
      categories: (cats.length? cats : (Array.isArray(byId[id]?.categories)? byId[id].categories : []) ),
      primary: (raw.primary||byId[id]?.primary|| (cats[0]||'') )
    };
    byId[id] = merged;
  });
  const mergedArr = Object.values(byId);
  FAQS.length = 0; mergedArr.forEach(x=>FAQS.push(x));
  renderSections();
  updateSuggest(document.getElementById('search').value||'');
}

/* manual import */
importBtn?.addEventListener('click', ()=> fileInput.click());
fileInput?.addEventListener('change', ()=>{
  const file = fileInput.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = (e)=>{
    try{
      const text = e.target.result;
      if(file.name.endsWith('.json')){
        const data = JSON.parse(text);
        const items = Array.isArray(data)? data : (data.items || []);
        mergeItems(items);
      }else{
        const rows = parseCSV(text);
        mergeItems(rows);
      }
      alert('FAQ imported and merged successfully.');
    }catch(err){
      console.error(err);
      alert('Import failed. Please check file format.');
    }finally{
      fileInput.value='';
    }
  };
  reader.readAsText(file, 'utf-8');
});

/* ============= CSV Auto-Loader (embedded use) =============*/
async function loadCsvAndMerge(){
  try{
    const resp = await fetch('faq_full_with_answers.csv', {cache:'no-store'});
    if(!resp.ok) { renderSections(); return; } // CSVが無ければダミーのみ
    const text = await resp.text();
    const rows = parseCSV(text);
    mergeItems(rows);
  }catch(e){
    console.warn('CSV auto-load failed:', e);
    renderSections();
  }
}

/* ============= Boot =============*/
document.getElementById('year').textContent = new Date().getFullYear();
loadCsvAndMerge(); // 起動時にCSVを探して読み込み
</script>
</body>
</html>
