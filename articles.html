<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FAQ Article | Seed Planning</title>
<meta name="description" content="Japan Healthcare Market Research FAQ article." />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2248%22 fill=%22%235baaae%22/><text x=%2250%22 y=%2263%22 font-size=%2255%22 text-anchor=%22middle%22 fill=%22white%22 font-family=%22Arial%22>SP</text></svg>">
<style>
  :root{--bg:#ffffff;--ink:#20323a;--muted:#5f7a84;--line:#e6eff1;--accent:#2f6f7e;--accent-2:#5baaae;--chip:#edf7f7;--mark:#fff3b0;--radius:14px;--shadow:0 6px 24px rgba(24,60,70,.08)}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Inter","Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Arial;line-height:1.75}
  a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
  header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.9);backdrop-filter:saturate(160%) blur(10px);border-bottom:1px solid var(--line)}
  .wrap{max-width:1120px;margin:0 auto;padding:18px 20px}
  .topbar{display:flex;align-items:center;gap:16px;justify-content:space-between;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{height:34px}
  .pill{display:inline-block;background:var(--chip);color:var(--accent);border:1px solid #d9ecec;padding:4px 10px;border-radius:999px;font-size:12px}
  .search{position:relative;flex:1 1 520px;max-width:720px;display:flex;align-items:center;gap:10px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:10px 14px;box-shadow:var(--shadow)}
  .search input{flex:1;border:0;outline:0;font-size:16px;background:transparent;padding:6px 2px}
  .grid{display:grid;grid-template-columns:1fr;gap:22px}
  @media (min-width:980px){.grid{grid-template-columns:3fr 1.25fr}}
  .article{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:22px;box-shadow:var(--shadow)}
  .article h1{margin:0 0 10px;font-size:28px;line-height:1.3}
  .meta{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 14px}
  .tag{font-size:12px;color:var(--muted)}
  .content p{margin:12px 0}
  .sidebar{position:sticky;top:98px;align-self:start;background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  .sidebar h3{margin:0 0 10px;font-size:16px}
  .sidebar ul{margin:0;padding-left:18px}
  .sidebar li{margin:6px 0}
  .related{margin-top:22px;background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  mark{background:var(--mark);padding:0 .2em}
  .empty{color:var(--muted)}
  footer.site{margin:36px 0 80px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <a class="pill" href="index.html">← Back to Index</a>
    </div>
    <div class="search" role="search" aria-label="Search all FAQs">
      <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M10 2a8 8 0 0 1 6.32 12.906l4.387 4.387l-1.414 1.414l-4.387-4.387A8 8 0 1 1 10 2m0 2a6 6 0 1 0 0 12a6 6 0 0 0 0-12"/></svg>
      <input id="search" type="search" placeholder="Search all FAQs… (Enter to jump)" autocomplete="off" />
    </div>
  </div>
</header>

<div class="wrap grid">
  <article class="article">
    <h1 id="title" class="empty">Loading…</h1>
    <div class="meta" id="meta"></div>
    <div id="content" class="content empty">Please wait.</div>

    <section class="related" id="related" hidden>
      <h3>You may also be interested in…</h3>
      <ul id="related-list"></ul>
    </section>
  </article>

  <aside class="sidebar">
    <h3>Articles in this section</h3>
    <ul id="section-list"></ul>
  </aside>
</div>

<footer class="site"><p>© <span id="year"></span> Seed Planning.</p></footer>

<!-- Load data -->
<script src="data/faqs.js"></script>

<script>
/* ===== Data prep ===== */
const ALL = Array.isArray(window.FAQS)? window.FAQS : [];
const map = new Map(); for(const it of ALL){ map.set(it.id, it); } // dedup by id
const FAQS = [...map.values()];
const byId = Object.fromEntries(FAQS.map(x=>[x.id,x]));

/* ===== Utilities ===== */
const params = new URLSearchParams(location.search);
const qid = params.get('id');
const sTerm = params.get('s') || '';
const $ = sel => document.querySelector(sel);
function escapeHTML(s){return String(s||"").replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]) )}
function markOnce(text,term){
  if(!term) return escapeHTML(text);
  const t=String(text||''),i=t.toLowerCase().indexOf(term.toLowerCase());
  if(i<0) return escapeHTML(t);
  return escapeHTML(t.slice(0,i))+`<mark>${escapeHTML(t.slice(i,i+term.length))}</mark>`+escapeHTML(t.slice(i+term.length));
}

/* ===== Render article ===== */
function renderArticle(id){
  const a = byId[id];
  const titleEl = $('#title'), metaEl = $('#meta'), contEl = $('#content');
  const sectionList = $('#section-list'), relBox = $('#related'), relList = $('#related-list');

  if(!a){
    document.title = 'Not found | FAQ';
    titleEl.textContent = 'Not found';
    contEl.classList.remove('empty');
    contEl.innerHTML = 'The requested article does not exist. <a href="index.html">Back to Index</a>.';
    sectionList.innerHTML = '';
    relBox.hidden = true;
    return;
  }

  document.title = a.question + ' | FAQ';
  titleEl.textContent = a.question;
  metaEl.innerHTML = (a.categories||[]).map(c=>`<span class="tag">#${escapeHTML(c)}</span>`).join(' ');
  contEl.classList.remove('empty');
  const body = (sTerm ? markOnce(a.answer, sTerm) : escapeHTML(a.answer)).replace(/\n\n/g,'</p><p>');
  contEl.innerHTML = `<p>${body}</p>`;

  // Section list (same primary)
  const section = a.primary || (a.categories||[])[0];
  const siblings = FAQS
    .filter(x=>x.id!==a.id && (x.primary||x.categories?.[0])===section)
    .slice(0, 14);
  sectionList.innerHTML = siblings
    .map(s=>`<li><a href="articles.html?id=${encodeURIComponent(s.id)}">${escapeHTML(s.question)}</a></li>`)
    .join('');

  // Related (categories Jaccard + keyword overlap)
  const termsA = new Set((a.question+' '+a.answer).toLowerCase().split(/\W+/).filter(t=>t.length>3));
  function score(b){
    const A=new Set(a.categories||[]), B=new Set(b.categories||[]);
    const inter=[...A].filter(x=>B.has(x)).length, uni=new Set([...A,...B]).size;
    let sc = (inter/(uni||1))*3;
    const termsB = new Set((b.question+' '+b.answer).toLowerCase().split(/\W+/).filter(t=>t.length>3));
    let kw=0; termsB.forEach(t=>{ if(termsA.has(t)) kw++; });
    sc += Math.min(kw/10, 2);
    if((b.primary||b.categories?.[0])===section) sc+=0.5;
    return sc;
  }
  const rel = FAQS.filter(x=>x.id!==a.id)
                  .map(x=>({x,sc:score(x)}))
                  .sort((m,n)=>n.sc-m.sc)
                  .slice(0,6);
  relList.innerHTML = rel.map(r=>`<li><a href="articles.html?id=${encodeURIComponent(r.x.id)}">${escapeHTML(r.x.question)}</a></li>`).join('');
  relBox.hidden = rel.length===0;
}

/* ===== Search across all ===== */
const searchEl = $('#search');
function normalize(s){return String(s||'').toLowerCase()}
function bestMatch(q){
  const terms = normalize(q).split(/\s+/).filter(Boolean);
  const scored = FAQS.map(it=>{
    let s=0; terms.forEach(t=>{
      const hay=(it.question+' '+(it.answer||'')).toLowerCase();
      if(hay.includes(t)) s+=2;
      if((it.question||'').toLowerCase().includes(t)) s+=2;
    });
    return {it, s};
  }).filter(x=>x.s>0).sort((a,b)=>b.s-a.s);
  return scored[0]?.it;
}
searchEl.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    const q=e.target.value.trim(); if(!q) return;
    const top = bestMatch(q);
    if(top) location.href=`articles.html?id=${encodeURIComponent(top.id)}&s=${encodeURIComponent(q)}`;
  }
});
document.addEventListener('keydown',e=>{
  if(e.key==='/'&&!/input|textarea/i.test(document.activeElement.tagName)){e.preventDefault();searchEl.focus();}
});

/* ===== Boot ===== */
$('#year').textContent = new Date().getFullYear();
renderArticle(qid || FAQS[0]?.id || '');
</script>
</body>
</html>
