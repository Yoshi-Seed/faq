<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FAQ Article | Seed Planning</title>
<meta name="description" content="Japan Healthcare Market Research FAQ article." />
<style>
  :root{--bg:#ffffff;--ink:#20323a;--muted:#5f7a84;--line:#e6eff1;--accent:#2f6f7e;--accent-2:#5baaae;--chip:#edf7f7;--mark:#fff3b0;--radius:14px;--shadow:0 4px 18px rgba(20,50,60,.08)}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Noto Sans","Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;line-height:1.7}
  a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
  header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.9);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--line)}
  .wrap{max-width:1100px;margin:0 auto;padding:22px 20px}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:14px}
  .brand img{height:34px}
  .search{position:relative;flex:1 1 520px;max-width:680px;display:flex;align-items:center;gap:10px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:8px 14px;box-shadow:var(--shadow)}
  .search input{flex:1;border:0;outline:0;font-size:16px;background:transparent;padding:6px 2px}
  .grid{display:grid;grid-template-columns:1fr;gap:22px}
  @media (min-width:980px){.grid{grid-template-columns:3fr 1.2fr}}
  .article{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:22px;box-shadow:var(--shadow)}
  .article h1{margin:0 0 12px;font-size:28px}
  .meta{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}
  .tag{font-size:12px;color:var(--muted)}
  .sidebar{position:sticky;top:96px;align-self:start;background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  .sidebar h3{margin:0 0 10px;font-size:16px}
  .sidebar ul{margin:0;padding-left:18px}
  .sidebar li{margin:6px 0}
  .related{margin-top:22px;background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
  mark{background:var(--mark);padding:0 .2em}
  footer.site{margin:36px 0 80px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <a href="index.html"><img src="seed-planning-logo.png" alt="Seed Planning" onerror="this.style.display='none'"></a>
      <div class="tag"><a href="index.html">Back to Index</a></div>
    </div>
    <div class="search" role="search" aria-label="Search FAQ">
      <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M10 2a8 8 0 0 1 6.32 12.906l4.387 4.387l-1.414 1.414l-4.387-4.387A8 8 0 1 1 10 2m0 2a6 6 0 1 0 0 12a6 6 0 0 0 0-12"/></svg>
      <input id="search" type="search" placeholder="Search all FAQs..." autocomplete="off" />
    </div>
  </div>
</header>

<div class="wrap grid">
  <article class="article" id="article">
    <h1 id="title"></h1>
    <div class="meta" id="meta"></div>
    <div id="content"></div>
    <section class="related" id="related">
      <h3>You may also be interested in…</h3>
      <ul id="related-list"></ul>
    </section>
  </article>

  <aside class="sidebar">
    <h3>Articles in this section</h3>
    <ul id="section-list"></ul>
  </aside>
</div>

<footer class="site"><p>© <span id="year"></span> Seed Planning.</p></footer>

<!-- Embedded data -->
<script id="faq-data" type="application/json">/* 同じデータを埋め込み（省略せず貼付）。index.html内と同じJSONをここにも入れる */</script>

<script>
const FAQS=JSON.parse(document.getElementById('faq-data').textContent);
const byId=Object.fromEntries(FAQS.map(x=>[x.id,x]));
const params=new URLSearchParams(location.search);
const qid=params.get('id');
const searchEl=document.getElementById('search');

function escapeHTML(s){return String(s||"").replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
function mark(text,term){
  if(!term) return escapeHTML(text);
  const t=String(text||''),i=t.toLowerCase().indexOf(term.toLowerCase());
  if(i<0) return escapeHTML(t);
  return escapeHTML(t.slice(0,i))+`<mark>${escapeHTML(t.slice(i,i+term.length))}</mark>`+escapeHTML(t.slice(i+term.length));
}

function renderArticle(id){
  const a=byId[id]; if(!a){document.getElementById('title').textContent='Not found'; return;}
  document.title = a.question + " | FAQ";
  document.getElementById('title').textContent=a.question;
  document.getElementById('meta').innerHTML=a.categories.map(c=>`<span class="tag">#${c}</span>`).join(' ');
  document.getElementById('content').innerHTML = `<p>${escapeHTML(a.answer).replace(/\n\n/g,'</p><p>')}</p>`;

  // Section list (same primary)
  const section = a.primary || a.categories[0];
  const sectionList=document.getElementById('section-list');
  const siblings=FAQS.filter(x=>x.id!==id && (x.primary||x.categories[0])===section).slice(0,12);
  sectionList.innerHTML = siblings.map(s=>`<li><a href="article.html?id=${encodeURIComponent(s.id)}">${escapeHTML(s.question)}</a></li>`).join('');

  // Related: Jaccard on categories + simple keyword overlap
  const terms=new Set((a.question+' '+a.answer).toLowerCase().split(/\W+/).filter(t=>t.length>3));
  function score(b){
    const catsA=new Set(a.categories), catsB=new Set(b.categories);
    const inter=[...catsA].filter(x=>catsB.has(x)).length;
    const union=new Set([...catsA,...catsB]).size;
    let s= inter/(union||1) * 3; // category weight
    const termsB=new Set((b.question+' '+b.answer).toLowerCase().split(/\W+/).filter(t=>t.length>3));
    let kw=0; termsB.forEach(t=>{ if(terms.has(t)) kw++; });
    s += Math.min(kw/10,2); // cap keyword influence
    if((b.primary||b.categories[0])===(a.primary||a.categories[0])) s+=0.5;
    return s;
  }
  const rel=FAQS.filter(x=>x.id!==id).map(x=>({x,sc:score(x)})).sort((m,n)=>n.sc-m.sc).slice(0,6);
  document.getElementById('related-list').innerHTML = rel.map(r=>`<li><a href="article.html?id=${encodeURIComponent(r.x.id)}">${escapeHTML(r.x.question)}</a></li>`).join('');
}

function normalize(s){return String(s||'').toLowerCase()}
function snippet(text,q){
  const t=String(text||''),i=t.toLowerCase().indexOf(q.toLowerCase());
  if(i<0) return escapeHTML(t.slice(0,140))+(t.length>140?'…':'');
  const s=Math.max(0,i-60),e=Math.min(t.length,i+q.length+60);
  return (s>0?'…':'')+escapeHTML(t.slice(s,i))+`<mark>${escapeHTML(t.slice(i,i+q.length))}</mark>`+escapeHTML(t.slice(i+q.length,e))+(e<t.length?'…':'');
}
function searchAll(q){
  const terms=normalize(q).split(/\s+/).filter(Boolean);
  return FAQS.map(it=>{
    let score=0; terms.forEach(t=>{if((it.question+' '+it.answer).toLowerCase().includes(t))score+=2;if(it.question.toLowerCase().includes(t))score+=2});
    return {it,score};
  }).filter(x=>x.score>0).sort((a,b)=>b.score-a.score).slice(0,10);
}
searchEl.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    const q=e.target.value.trim(); if(!q) return;
    const top=searchAll(q)[0]; if(top) location.href=`article.html?id=${encodeURIComponent(top.it.id)}&s=${encodeURIComponent(q)}`;
  }
});

document.getElementById('year').textContent=new Date().getFullYear();
renderArticle(qid||'Q1');

// optional highlight from ?s=term
const sTerm=new URLSearchParams(location.search).get('s');
if(sTerm){ document.getElementById('content').innerHTML = mark(document.getElementById('content').textContent, sTerm).replace(/\n\n/g,'</p><p>'); }
</script>
</body>
</html>
